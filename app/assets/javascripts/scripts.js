// Generated by CoffeeScript 1.3.3

$(function() {
  var find_next_unpopulated_pick, increment_total_picks, pick_is_not_duplicate;
  if ($("body").hasClass("pools-admin_dashboard")) {
    $(".entry-row").on("click", ".approve-entry", function(e) {
      $.ajax({
        url: "/pool-users/approve-entry",
        method: "POST",
        data: {
          entry_id: $(e.target).attr("data-entry-id")
        }
      });
      $(e.target).parents("tr").find("td.approval-mark").removeClass("unapproved").addClass("approved").text("✔");
      return $(e.target).parents("tr").find(".approve-entry").removeClass("approve-entry").addClass("remove-approval").text("Remove Approval");
    });
    $(".entry-row").on("click", ".remove-approval", function(e) {
      $.ajax({
        url: "/pool-users/remove-approval",
        method: "POST",
        data: {
          entry_id: $(e.target).attr("data-entry-id")
        }
      });
      $(e.target).parents("tr").find("td.approval-mark").removeClass("approved").addClass("unapproved").text("✘");
      return $(e.target).parents("tr").find(".remove-approval").removeClass("remove-approval").addClass("approve-entry").text("Approve Entry");
    });
  }
  if ($("body").hasClass("nfl_picks-new") && $(".pool").attr("data-pool-type") === "supercontest") {
    $(".matchup-team").on("click", function(e) {
      var $row_to_populate, pick_number, team_picked;
      team_picked = $(e.target).attr("data-team-id");
      pick_number = find_next_unpopulated_pick();
      if (pick_number) {
        if (pick_is_not_duplicate(team_picked)) {
          $row_to_populate = $("tr.pick" + pick_number);
          $row_to_populate.find(".pick").text($(e.target).text()).attr("data-team-id", team_picked);
          return increment_total_picks();
        } else {
          return alert("You have already chosen this team");
        }
      } else {
        return alert("You need to delete a pick before you can make another one");
      }
    });
    find_next_unpopulated_pick = function() {
      var total_picks;
      total_picks = parseInt($(".picks-table").attr("data-total-picks"), 10);
      if (total_picks < 5) {
        return total_picks + 1;
      } else {
        return false;
      }
    };
    increment_total_picks = function() {
      var total_picks;
      total_picks = parseInt($(".picks-table").attr("data-total-picks"), 10);
      return $(".picks-table").attr("data-total-picks", total_picks + 1);
    };
    return pick_is_not_duplicate = function(team_picked) {
      var teams_picked;
      teams_picked = [];
      _.each($("td.pick"), function(item) {
        if ($(item).attr("data-team-id")) {
          return teams_picked.push($(item).attr("data-team-id"));
        }
      });
      if (_.include(teams_picked, team_picked)) {
        return false;
      } else {
        return true;
      }
    };
  }
});
